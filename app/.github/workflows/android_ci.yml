steps:
  - name: Checkout Code
    uses: actions/checkout@v4

  # Set up Java 17 for modern Android projects
  - name: Set up JDK 17
    uses: actions/setup-java@v4
    with:
      distribution: 'temurin'
      java-version: '17'

  # Caching speeds up builds by reusing downloaded dependencies
  - name: Cache Gradle dependencies
    uses: actions/cache@v4
    with:
      path: |
        ~/.gradle/caches
        ~/.gradle/wrapper
      # Key is based on OS and project dependency files
      key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
      restore-keys: |
        ${{ runner.os }}-gradle-

  # Grant execution rights to the gradlew file
  - name: Make Gradle Wrapper Executable
    run: chmod +x ./gradlew

  # 1. Run Local Unit Tests (includes FakeServiceDao and Compose Unit Tests running locally)
  - name: Run Unit Tests
    run: ./gradlew test

  # 2. Build the Debug APK to check for build errors
  - name: Build Debug APK
    run: ./gradlew assembleDebug

  # 3. Run Lint Checks for code quality and warnings
  - name: Run Lint
    run: ./gradlew lintDebug

  # 4. Upload the built APK as an artifact (optional but useful)
  - name: Upload APK Artifact
    uses: actions/upload-artifact@v4
    with:
      name: debug-apk
      path: app/build/outputs/apk/debug/app-debug.apk