name: Android CI/CD Pipeline

on:
  push:
    branches: [ master ] # Triggers on push to master

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    # Define an environment variable for the Firebase App ID
    env:
      FIREBASE_APP_ID: 'beautyparlor-ae20d' # <-- REPLACE THIS

    steps:
      - name: â¬‡ï¸ Checkout Code
        uses: actions/checkout@v4

      - name: â˜• Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: âš™ï¸ Setup Gradle Cache
        uses: gradle/actions/setup-gradle@v3

      - name: âž• Grant execute permission for gradlew
        run: chmod +x gradlew

      # --- CI Stages (Build & Test) ---
      - name: ðŸ§ª Run Unit Tests
        run: ./gradlew test

      - name: ðŸ—ï¸ Assemble Debug APK
        # Use assembleRelease if you configure signing (recommended for CD)
        run: ./gradlew assembleDebug

      # --- CD Stage (Deployment) ---
      - name: ðŸš€ Deploy to Firebase App Distribution
        if: success() # Only deploy if the build and tests passed
        uses: wziegler/firebase-app-distribution-action@v1
        with:
          # Service account JSON secret we created earlier
          serviceCredentialsFileContent: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_KEY }}

          # The App ID for your Android project in Firebase
          appId: ${{ env.FIREBASE_APP_ID }}

          # Path to the APK/AAB artifact to upload
          file: app/build/outputs/apk/debug/app-debug.apk

          # Optional: Specify the testers/groups to receive the build
          groups: 'testers, internal-users'
          # Optional: Add release notes
          releaseNotes: "CI/CD automated build ${{ github.sha }}."